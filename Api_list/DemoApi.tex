1. Find the total number of active categories.

[
  {
    $match: {
      "isActive" : true
    }
  },
  {
    $count: 'NoOFActive'
  }
  
]

{
  "NoOFActive": 9
}
--------------------------------------------------------------------------------------------------
2. Retrieve the list of users who have made more than 1 orders.

[
  {
    $group: {
      _id: "$user_id",
      "user_id": {
        $first: "$user_id"
      },
      "OrderCount": {
      		$sum: 1
      }
    }
  },
  {
    $match: {
      "OrderCount" : {$gt : 1}
    }
  },
  {
    $lookup: {
      from: "users",
      localField: "user_id",
      foreignField: "_id",
      as: "user"
    }
  },
  {
    $unwind: {
      path: "$user",
    }
  },
  {
    $project: {
      "_id" : 0,
      "user_id" : 1,
      "user.name" : 1,
      "OrderCount": 1
    }
  }
]

{
  "user_id": 1,
  "OrderCount": 2,
  "user": {
    "name": "John Doe"
  }
}
{
  "user_id": 5,
  "OrderCount": 2,
  "user": {
    "name": "Charlie Davis"
  }
}
{
  "user_id": 3,
  "OrderCount": 3,
  "user": {
    "name": "Bob Johnson"
  }
}
--------------------------------------------------------------------------------------------------
3. Calculate the total revenue generated by each seller.

[
  {
    $group: {
      _id: "$seller_id",
      "TotalRevenue": {
        $sum: "$total_amount"
      }
    }
  }
]


{
  "_id": 11,
  "TotalRevenue": 4849.83
}
{
  "_id": 12,
  "TotalRevenue": 3639.82
}


[
  {
    $group: {
      _id: "$seller_id",
      "TotalRevenue": {
        $sum: "$total_amount"
      }
    }
  },
  {
    $lookup: {
      from: "users",
      localField: "_id",
      foreignField: "_id",
      as: "user"
    }
  },
  {
    $unwind: {
      path: "$user"
    }
  },
  {
    $project: {
      "user.name" : 1,
      "user.mobile_no": 1,
      "TotalRevenue": 1
    }
  }
]


{
  "_id": 12,
  "TotalRevenue": 3639.82,
  "user": {
    "name": "Seller Two",
    "mobile_no": "222-333-4444"
  }
}
{
  "_id": 11,
  "TotalRevenue": 4849.83,
  "user": {
    "name": "Seller One",
    "mobile_no": "111-222-3333"
  }
}
--------------------------------------------------------------------------------------------------
4. Retrieve the products with the highest average rating.

[
  {
    $group: {
      _id: "$product_id",
      "AvgRating": {
        $avg: "$rating"
      }
    }
  },
  {
    $sort: {
     "AvgRating":-1
    }
  },
  {
    $limit: 2
  }
]

{
  "_id": 9,
  "AvgRating": 4.8
}
{
  "_id": 3,
  "AvgRating": 4.8
}



[
  {
    $group: {
      _id: "$product_id",
      "AvgRating": {
        $avg: "$rating"
      }
    }
  },
  {
    $sort: {
      "AvgRating": -1
    }
  },
  {
    $limit: 1
  },
  {
    $lookup: {
      from: "products",
      localField: "_id",
      foreignField: "_id",
      as: "product"
    }
  },
  {
    $unwind: {
      path: "$product"
    }
  },
  {
    $project: {
      "product.name" : 1,
      "product.description" : 1,
      "AvgRating": 1
    }
  }
]

{
  "_id": 3,
  "AvgRating": 4.8,
  "product": {
    "name": "MacBook Pro",
    "description": "Powerful laptop for professionals"
  }
}
--------------------------------------------------------------------------------------------------
5. Calculate the total number of products in each subcategory.
[
  {
    $group: {
      _id: "$subcategory_id",
      "TotalProducts": {
        $sum: 1
      }
    }
  },
  {
    $project: {
      "_id" : 0,
      "subcategory_id" : "$_id",
      "TotalProducts": 1
    }
  }
]


{
  "TotalProducts": 2,
  "subcategory_id": 3
}
{
  "TotalProducts": 2,
  "subcategory_id": 5
}
{
  "TotalProducts": 1,
  "subcategory_id": 4
}
{
  "TotalProducts": 2,
  "subcategory_id": 7
}
{
  "TotalProducts": 1,
  "subcategory_id": 2
}
{
  "TotalProducts": 2,
  "subcategory_id": 1
}


[
  {
    $group: {
      _id: "$subcategory_id",
      "TotalProducts": {
        $sum: 1
      }
    }
  },
  {
    $lookup: {
      from: "subcategories",
      localField: "_id",
      foreignField: "_id",
      as:"subcategory"
    }
  },
  {
    $unwind: {
      path: "$subcategory"
    }
  },
  {
    $project: {
      "TotalProducts": 1,
      "subcategory.subcategory_name": 1,
      "subcategory.subcategory_desc": 1,
    }
  }
]


{
  "_id": 7,
  "TotalProducts": 2,
  "subcategory": {
    "subcategory_name": "Living Room",
    "subcategory_desc": "Furniture for the living room"
  }
}
{
  "_id": 4,
  "TotalProducts": 1,
  "subcategory": {
    "subcategory_name": "Jeans",
    "subcategory_desc": "Denim pants"
  }
}
{
  "_id": 3,
  "TotalProducts": 2,
  "subcategory": {
    "subcategory_name": "T-Shirts",
    "subcategory_desc": "Casual wear"
  }
}
{
  "_id": 5,
  "TotalProducts": 2,
  "subcategory": {
    "subcategory_name": "Fiction",
    "subcategory_desc": "Fictional books"
  }
}
{
  "_id": 1,
  "TotalProducts": 2,
  "subcategory": {
    "subcategory_name": "Smartphones",
    "subcategory_desc": "Smartphones and accessories"
  }
}
{
  "_id": 2,
  "TotalProducts": 1,
  "subcategory": {
    "subcategory_name": "Laptops",
    "subcategory_desc": "Laptops and accessories"
  }
}

--------------------------------------------------------------------------------------------------

6. Find the users who have not made any orders.

[
  {
    $lookup: {
      from: "orders",
      localField: "_id",
      foreignField: "_id",
      as: "order"
    }
  },
  {
    $match: {
      "order" : {$eq : []}
    }
  },
  {
    $project: {
      "name": 1,
      "order": 1
    }
  }
]

{
  "_id": 11,
  "name": "Seller One",
  "order": []
}
{
  "_id": 12,
  "name": "Seller Two",
  "order": []
}




[
  {
    $lookup: {
      from: "orders",
      localField: "_id",
      foreignField: "user_id",
      as: "order"
    }
  },
  {
    $match: {
      "order": {$eq : []}
    }
  },
  {
    $project: {
      name: 1,
      mobile_no: 1
    }
  }
]


{
  "_id": 8,
  "name": "Grace Taylor",
  "mobile_no": "222-333-4444"
}
{
  "_id": 2,
  "name": "Jane Smith",
  "mobile_no": "987-654-3210"
}
{
  "_id": 4,
  "name": "Alice Brown",
  "mobile_no": "111-222-3333"
}
{
  "_id": 10,
  "name": "Ivy Evans",
  "mobile_no": "777-888-9999"
}
{
  "_id": 11,
  "name": "Seller One",
  "mobile_no": "111-222-3333"
}
{
  "_id": 12,
  "name": "Seller Two",
  "mobile_no": "222-333-4444"
}
--------------------------------------------------------------------------------------------------

7. Identify the most popular product (highest number of reviews).

[
  {
    $group: {
      _id: "$product_id",
      "TotalRating": {
       	$sum: 1
      }
    }
  },
  {
    $sort: {
      "TotalRating": -1
    }
  },
  {
    $limit: 1
  },
  {
    $lookup: {
      from: "products",
      localField: "_id",
      foreignField: "_id",
      as: "product"
    }
  },
  {
    $unwind: {
      path: "$product"
    }
  },
  {
    $project: {
      "TotalRating": 1,
      "product.name": 1,
      "product.description": 1
    }
  }
]

{
  "_id": 1,
  "TotalRating": 2,
  "product": {
    "name": "iPhone 12",
    "description": "Flagship smartphone"
  }
}




Identify the most popular product (highest number of orders).

[
  {
    $unwind: {
      path: "$products"
    }
  },
  {
    $group: {
      _id: "$products.product_id",
      "CountOrder": {
        $sum: 1
      }
    }
  },
  {
    $sort: {
      "CountOrder": -1
    }
  },
  {
    $limit : 5
  },
  {
    $lookup: {
      from: "products",
      localField: "_id",
      foreignField: "_id",
      as: "product"
    }
  },
  {
    $unwind: {
      path: "$product"
    }
  },
  {
    $project: {
      "CountOrder": 1,
      "product.name": 1,
      "product.description": 1
    }
  }
]


{
  "_id": 3,
  "CountOrder": 3,
  "product": {
    "name": "MacBook Pro",
    "description": "Powerful laptop for professionals"
  }
}
{
  "_id": 5,
  "CountOrder": 3,
  "product": {
    "name": "V-Neck T-Shirt",
    "description": "Stylish casual wear"
  }
}
{
  "_id": 1,
  "CountOrder": 3,
  "product": {
    "name": "iPhone 12",
    "description": "Flagship smartphone"
  }
}
{
  "_id": 7,
  "CountOrder": 3,
  "product": {
    "name": "The Great Gatsby",
    "description": "Classic fiction novel"
  }
}
{
  "_id": 9,
  "CountOrder": 2,
  "product": {
    "name": "Leather Sofa",
    "description": "Elegant living room furniture"
  }
}
--------------------------------------------------------------------------------------------------
8. Calculate the total revenue and average order value for each seller.
[
  {
    $group: {
      _id: "$seller_id",
      "TotalRevenue": {
        $sum: "$total_amount"
      },
      "OrderCount": {
        $sum: 1
      },
      "AvgRevenue" : {
        $avg: "$total_amount"
      }
    }
  },
  {
    $lookup: {
      from: "users",
      localField: "_id",
      foreignField: "_id",
      as: "user"
    }
  },
  {
    $unwind: {
      path: "$user"
    }
  },
  {
    $project: {
      "TotalRevenue": 1,
      "OrderCount": 1,
      "AvgRevenue": 1,
      "user.name": 1
    }
  }
]

{
  "_id": 12,
  "TotalRevenue": 3639.82,
  "OrderCount": 5,
  "AvgRevenue": 727.964,
  "user": {
    "name": "Seller Two"
  }
}
{
  "_id": 11,
  "TotalRevenue": 4849.83,
  "OrderCount": 5,
  "AvgRevenue": 969.966,
  "user": {
    "name": "Seller One"
  }
}





--------------------------------------------------------------------------------------------------
9. Find the products with a quantity less than 20 in the Variant collection.
[
  {
    $match: {
      "attributes.Quantity" : {$lt : 20}
    }
  },
  {
    $project: {
      "attributes.Quantity" : 1
    }
  }
]


{
  "_id": 10,
  "attributes": {
    "Quantity": 15
  }
}
--------------------------------------------------------------------------------------------------
10. Retrieve the top 5 customers with the highest total order value.

[
  {
    $group: {
      _id: "$user_id" ,
      "TotalSpent": {
        $sum: "$total_amount"
      }
    }
  },
  {
    $sort: {
      "TotalSpent": -1
    }
  },
  {
    $limit: 5
  },
  {
    $lookup: {
      from: "users",
      localField: "_id",
      foreignField: "_id",
      as: "user"
    }
  },
  {
    $unwind: {
      path: "$user"
    }
  },
  {
    $project: {
      "TotalSpent" : 1,
      "user.name": 1
    }
  }
]


{
  "_id": 3,
  "TotalSpent": 4299.92,
  "user": {
    "name": "Bob Johnson"
  }
}
{
  "_id": 1,
  "TotalSpent": 2679.95,
  "user": {
    "name": "John Doe"
  }
}
{
  "_id": 5,
  "TotalSpent": 519.9,
  "user": {
    "name": "Charlie Davis"
  }
}
{
  "_id": 9,
  "TotalSpent": 424.94,
  "user": {
    "name": "Harry Adams"
  }
}
{
  "_id": 7,
  "TotalSpent": 399.97,
  "user": {
    "name": "Frank Miller"
  }
}


--------------------------------------------------------------------------------------------------
11. Find the average rating for each product.

[
  {
    $group: {
      _id: "$product_id",
      "AvgRating": {
        $avg: "$rating"
      }
    }
  },
  {
    $sort: {
      "AvgRating": -1
    }
  },
  {
    $limit: 2
  },
  {
    $lookup: {
      from: "products",
      localField: "_id",
      foreignField: "_id",
      as: "product"
    }
  },
  {
    $unwind: {
      path: "$product"
    }
  },
  {
    $project: {
      "AvgRating" : 1,
      "product.name": 1,
      "product.description": 1
    }
  }
]


{
  "_id": 9,
  "AvgRating": 4.8,
  "product": {
    "name": "Leather Sofa",
    "description": "Elegant living room furniture"
  }
}
{
  "_id": 3,
  "AvgRating": 4.8,
  "product": {
    "name": "MacBook Pro",
    "description": "Powerful laptop for professionals"
  }
}
--------------------------------------------------------------------------------------------------
12. Retrieve the latest 5 reviews with user details.
--------------------------------------------------------------------------------------------------
13. Identify the users who have items in their cart with a quantity greater than 3.
[
  {
    $unwind: {
      path: "$items"
    }
  },
  {
    $group: {
      _id: "$user_id",
      "CountQty": {
       $sum: "$items.quantity"
      }
    }
  },
  {
   $match: {
     "CountQty": {$gt: 3}
   }
  },
  {
    $lookup: {
      from: "users",
      localField: "_id",
      foreignField: "_id",
      as: "user"
    }
  },
  {
    $unwind: {
      path: "$user",
    }
  },
  {
    $project: {
      "CountQty": 1,
      "user.name" : 1,
      "user.mobile_no": 1
    }
  }
]

{
  "_id": 2,
  "CountQty": 4,
  "user": {
    "name": "Jane Smith",
    "mobile_no": "987-654-3210"
  }
}
{
  "_id": 5,
  "CountQty": 4,
  "user": {
    "name": "Charlie Davis",
    "mobile_no": "333-444-5555"
  }
}
{
  "_id": 8,
  "CountQty": 4,
  "user": {
    "name": "Grace Taylor",
    "mobile_no": "222-333-4444"
  }
}
--------------------------------------------------------------------------------------------------
14. Calculate the total number of orders placed using each payment gateway.
[
  {
    $match: {
      "status": "Completed"
    }
  },
  {
    $group: {
      _id: "$gateway",
      "order_id": {$push: "$order_id"},
      "OrderCount": {
        $sum: 1
      }
    }
  },
  {
    $lookup: {
      from: "orders",
      localField: "order_id",
      foreignField: "_id",
      as: "order"
    }
  },
  {
    $project: {
      "_id" : 1,
      "OrderCount": 1,
      "order": 1
    }
  }
]


{
  "_id": "PayPal",
  "OrderCount": 1,
  "order": [
    {
      "_id": 2,
      "user_id": 1,
      "seller_id": 12,
      "payment_id": 102,
      "products": [
        {
          "product_id": 5,
          "quantity": 3
        },
        {
          "product_id": 7,
          "quantity": 2
        }
      ],
      "shipping_address": "456 Oak St, Townsville",
      "total_amount": 179.95,
      "status": "Shipped",
      "discount": 10,
      "isActive": true
    }
  ]
}

{
  "_id": "Credit Card",
  "OrderCount": 2,
  "order": [
    {
      "_id": 9,
      "user_id": 9,
      "seller_id": 11,
      "payment_id": 109,
      "products": [
        {
          "product_id": 3,
          "quantity": 2
        },
        {
          "product_id": 5,
          "quantity": 1
        }
      ],
      "shipping_address": "606 Oak St, Hillside",
      "total_amount": 424.94,
      "status": "Completed",
      "discount": 5,
      "isActive": true
    },
    {
      "_id": 1,
      "user_id": 1,
      "seller_id": 11,
      "payment_id": 101,
      "products": [
        {
          "product_id": 1,
          "quantity": 2
        },
        {
          "product_id": 3,
          "quantity": 1,
          "variant_id": 1
        }
      ],
      "shipping_address": "123 Main St, Cityville",
      "total_amount": 2500,
      "status": "Processing",
      "discount": 100,
      "isActive": true
    }
  ]
}

--------------------------------------------------------------------------------------------------
15. Find the subcategories with no active products.

[
  {
    $lookup: {
      from: "products",
      localField: "_id",
      foreignField: "subcategory_id",
      as: "product"
    }
  },
  {
    $match: {
      "product" : {$ne : []}
    }
  },
  {
    $unwind: {
      path: "$product"
    }
  },
  {
    $match: {
      "product.isActive" : false
    }
  },
  {
    $group: {
      _id: "$_id",
      "subcategory_name": {$first : "$subcategory_name"},
      "product" : {
        $push :"$product"
      }
    }
  }
  
]



{
  "_id": 1,
  "subcategory_name": "Smartphones",
  "product": [
    {
      "_id": 2,
      "category_id": 1,
      "subcategory_id": 1,
      "variant_id": 2,
      "name": "Samsung Galaxy S21",
      "description": "High-performance Android phone",
      "isActive": false
    }
  ]
}
{
  "_id": 4,
  "subcategory_name": "Jeans",
  "product": [
    {
      "_id": 6,
      "category_id": 2,
      "subcategory_id": 4,
      "variant_id": 6,
      "name": "Slim Fit Jeans",
      "description": "Fashionable denim pants",
      "isActive": false
    }
  ]
}


--------------------------------------------------------------------------------------------------

16. Retrieve the orders with a total amount greater than 2000 and status as "Completed."

[
  {
    $match: {
      "status" : "Completed",
      "total_amount": {$gt : 2000}
    }
  }
]



{
  "_id": 9,
  "user_id": 9,
  "seller_id": 11,
  "payment_id": 109,
  "products": [
    {
      "product_id": 3,
      "quantity": 2
    },
    {
      "product_id": 5,
      "quantity": 1
    }
  ],
  "shipping_address": "606 Oak St, Hillside",
  "total_amount": 4244.94,
  "status": "Completed",
  "discount": 5,
  "isActive": true
}
--------------------------------------------------------------------------------------------------
17. Identify the products that have not been reviewed.
[
  {
    $lookup: {
      from: "reviews",
      localField: "_id",
      foreignField: "product_id",
      as: "review"
    }
  },
  {
    $match: {
      "review" : {$eq : []}
    }
  },
  {
    $project: {
      "name": 1,
    	"description": 1,
    	"review": 1
    }
  }
]

{
  "_id": 10,
  "name": "Coffee Table",
  "description": "Functional and stylish",
  "review": []
}
--------------------------------------------------------------------------------------------------
18. Calculate the total revenue and total quantity sold for each product.

[
  {
    $unwind: {
      path: "$products",
    }
  },
  {
    $group: {
      _id: "$products.product_id",
     "totalRevenue": {
        $sum: "$total_amount"
      },
      "SoldQty": {
        $sum: "$products.quantity"
      }
    }
  },
  {
    $lookup: {
      from: "products",
      localField: "_id",
      foreignField: "_id",
      as: "product"
    }
  },
  {
    $unwind: {
      path: "$product"
    }
  },
  {
    $project: {
      "product.name" : 1,
      "totalRevenue": 1,
      "SoldQty": 1
    }
  }
]


{
  "_id": 4,
  "totalRevenue": 399.97,
  "SoldQty": 2,
  "product": {
    "name": "Cotton T-Shirt"
  }
}
{
  "_id": 5,
  "totalRevenue": 5774.87,
  "SoldQty": 5,
  "product": {
    "name": "V-Neck T-Shirt"
  }
}
{
  "_id": 3,
  "totalRevenue": 6919.879999999999,
  "SoldQty": 6,
  "product": {
    "name": "MacBook Pro"
  }
}
{
  "_id": 2,
  "totalRevenue": 399.97,
  "SoldQty": 1,
  "product": {
    "name": "Samsung Galaxy S21"
  }
}
{
  "_id": 1,
  "totalRevenue": 4899.95,
  "SoldQty": 5,
  "product": {
    "name": "iPhone 12"
  }
}
{
  "_id": 10,
  "totalRevenue": 1214.94,
  "SoldQty": 3,
  "product": {
    "name": "Coffee Table"
  }
}
{
  "_id": 7,
  "totalRevenue": 2424.88,
  "SoldQty": 7,
  "product": {
    "name": "The Great Gatsby"
  }
}
{
  "_id": 8,
  "totalRevenue": 164.97,
  "SoldQty": 2,
  "product": {
    "name": "To Kill a Mockingbird"
  }
}
{
  "_id": 9,
  "totalRevenue": 2244.93,
  "SoldQty": 2,
  "product": {
    "name": "Leather Sofa"
  }
}
{
  "_id": 6,
  "totalRevenue": 174.94,
  "SoldQty": 1,
  "product": {
    "name": "Slim Fit Jeans"
  }
}
--------------------------------------------------------------------------------------------------
19. Find the top 3 subcategories with the highest average product price.
[
  {
    $lookup: {
      from: "variants",
      localField: "_id",
      foreignField: "product_id",
      as: "variant"
    }
  },
  {
    $unwind: {
      path: "$variant",
    }
	},
  {
    $group: {
      _id: "$subcategory_id",
      "AvgPrice": {
        $avg: "$variant.attributes.Price"
      }
    }
  },
  {
    $sort: {
      "AvgPrice": -1
    }
  }, 
  {
    $limit: 3
  },
  {
    $project: {
      "_id" : 0,
      "subcategory_id" : "$_id",
      "AvgPrice": 1,
      
    }
  }
  
]


{
  "AvgPrice": 1999.99,
  "subcategory_id": 2
}
{
  "AvgPrice": 1099.99,
  "subcategory_id": 1
}
{
  "AvgPrice": 899.99,
  "subcategory_id": 7
}




[
  {
    $group: {
      _id: "$subcategory_id",
      "variant_id" : {$push : "$variant_id"}
    }
  },
  {
    $lookup: {
      from: "variants",
      localField: "variant_id",
      foreignField: "_id",
      as: "variant"
    }
  },
  {
    $unwind: {
      path: "$variant"
    }
  },
  {
    $group: {
      _id: "$_id",
      "AvgAmount": {
        $avg: "$variant.attributes.Price"
      }
    }
  },
  {
    $sort: {
      "AvgAmount": -1 
    }
  },
  {
    $limit: 3
  },
  {
    $lookup: {
      from: "subcategories",
      localField: "_id",
      foreignField: "_id",
      as: "subcategory"
    }
  },
  {
    $unwind: {
      path: "$subcategory"
    }
  },
  {
    $project: {
      "subcategory_name" : "$subcategory.subcategory_name",
      "AvgAmount" : 1
    }
  }
  
]

{
  "_id": 2,
  "AvgAmount": 1199.99,
  "subcategory_name": "Laptops"
}
{
  "_id": 1,
  "AvgAmount": 1049.99,
  "subcategory_name": "Smartphones"
}
{
  "_id": 3,
  "AvgAmount": 1009.99,
  "subcategory_name": "T-Shirts"
}

--------------------------------------------------------------------------------------------------
20. Retrieve the products that have received reviews with ratings greater than 4.

[
  {
    $lookup: {
      from: "reviews",
      localField: "_id",
      foreignField: "product_id",
      as: "review"
    }
  },
  {
    $match: {
      "review.rating" : {$gt : 4}
    }
  },
  {
    $project: {
      "name" : 1,
      "review": 1
    }
  }
  
]


{
  "_id": 1,
  "name": "iPhone 12",
  "review": [
    {
      "_id": 1,
      "user_id": 1,
      "product_id": 1,
      "rating": 4.5,
      "comment": "Great phone, fast and reliable!"
    },
    {
      "_id": 2,
      "user_id": 2,
      "product_id": 1,
      "rating": 5,
      "comment": "Excellent build quality and camera performance"
    }
  ]
}
{
  "_id": 9,
  "name": "Leather Sofa",
  "review": [
    {
      "_id": 10,
      "user_id": 10,
      "product_id": 9,
      "rating": 4.5,
      "comment": "Quality sofa, very comfortable"
    }
  ]
}
{
  "_id": 3,
  "name": "MacBook Pro",
  "review": [
    {
      "_id": 4,
      "user_id": 4,
      "product_id": 3,
      "rating": 4.8,
      "comment": "Impressive performance, but a bit expensive"
    }
  ]
}
{
  "_id": 8,
  "name": "To Kill a Mockingbird",
  "review": [
    {
      "_id": 9,
      "user_id": 9,
      "product_id": 8,
      "rating": 4.5,
      "comment": "Well-written, highly recommended"
    }
  ]
}
{
  "_id": 5,
  "name": "V-Neck T-Shirt",
  "review": [
    {
      "_id": 6,
      "user_id": 6,
      "product_id": 5,
      "rating": 4.2,
      "comment": "Comfortable and stylish"
    }
  ]
}
{
  "_id": 6,
  "name": "Slim Fit Jeans",
  "review": [
    {
      "_id": 7,
      "user_id": 7,
      "product_id": 6,
      "rating": 4.7,
      "comment": "Love the fit and color of these jeans"
    }
  ]
}
--------------------------------------------------------------------------------------------------
21. Retrieve product data with their variant details from category.
[
  {
    $lookup: {
      from: "products",
      localField: "_id",
      foreignField: "category_id",
      as: "product",
      pipeline : [
        {
           $lookup: {
              from: "variants",
              localField: "_id",
              foreignField: "product_id",
              as: "variant"
           }
        },
        {
					$unwind : "$variant"          
        },
        {
          $group : {
            _id : "$_id",
            variant : {$push : "$variant.attributes"}
          }
        }
      ]
    }
  },
  {
    $match: {
      "product" : {$ne : []}
    }
  },
  {
    $project: {
      "category_name" : 1,
      "product": 1
    }
  }
]


{
  "_id": 1,
  "category_name": "Electronics",
  "product": [
    {
      "_id": 3,
      "variant": [
        {
          "Color": "Space Gray",
          "Size": "15-inch",
          "Price": 1999.99,
          "Quantity": 20
        }
      ]
    },
    {
      "_id": 2,
      "variant": [
        {
          "Color": "Silver",
          "Size": "256GB",
          "Price": 1199.99,
          "Quantity": 40
        }
      ]
    },
    {
      "_id": 1,
      "variant": [
        {
          "Color": "Black",
          "Size": "64GB",
          "Price": 999.99,
          "Quantity": 50
        },
        {
          "Color": "White",
          "Size": "128GB",
          "Price": 1099.99,
          "Quantity": 30
        }
      ]
    }
  ]
}

{
  "_id": 2,
  "category_name": "Clothing",
  "product": [
    {
      "_id": 5,
      "variant": [
        {
          "Color": "Blue",
          "Size": "L",
          "Price": 24.99,
          "Quantity": 80
        }
      ]
    },
    {
      "_id": 6,
      "variant": [
        {
          "Color": "Dark Indigo",
          "Size": "32",
          "Price": 49.99,
          "Quantity": 60
        }
      ]
    },
    {
      "_id": 4,
      "variant": [
        {
          "Color": "Black",
          "Size": "M",
          "Price": 19.99,
          "Quantity": 100
        }
      ]
    }
  ]
}
{
  "_id": 3,
  "category_name": "Books",
  "product": [
    {
      "_id": 7,
      "variant": [
        {
          "Color": "Paperback",
          "Size": "Standard",
          "Price": 9.99,
          "Quantity": 120
        }
      ]
    },
    {
      "_id": 8,
      "variant": [
        {
          "Color": "Hardcover",
          "Size": "Large",
          "Price": 14.99,
          "Quantity": 90
        }
      ]
    }
  ]
}
{
  "_id": 4,
  "category_name": "Furniture",
  "product": [
    {
      "_id": 9,
      "variant": [
        {
          "Color": "Brown",
          "Size": "3-Seater",
          "Price": 899.99,
          "Quantity": 15
        }
      ]
    }
  ]
}
--------------------------------------------------------------------------------------------------
22. Retrieve Categories with Subcategory, Products with product count.

[
  {
    $lookup: {
      from: "subcategories",
      localField: "_id",
      foreignField: "category_id",
      as: "subcategory",
      pipeline : [
        {
          $lookup: {
            from: "products",
            localField: "_id",
            foreignField: "subcategory_id",
            as: "product"
          }
        },
        {
          $unwind : "$product"
        },
        {
          $group : {
            _id : "$_id",
            "subcategory_name" : {$first : "$subcategory_name"},
            "product_name": {$push : "$product.name"},
            "CountProduct" : {
              $sum : 1
            }
          }
        }
      ]
    }
  },
  {
    $match: {
      "subcategory" : {$ne : []}
    }
  }
]



{
  "_id": 2,
  "category_name": "Clothing",
  "category_desc": "Apparel and accessories",
  "isActive": true,
  "subcategory": [
    {
      "_id": 4,
      "subcategory_name": "Jeans",
      "product_name": [
        "Slim Fit Jeans"
      ],
      "CountProduct": 1
    },
    {
      "_id": 3,
      "subcategory_name": "T-Shirts",
      "product_name": [
        "Cotton T-Shirt",
        "V-Neck T-Shirt"
      ],
      "CountProduct": 2
    }
  ]
}
{
  "_id": 3,
  "category_name": "Books",
  "category_desc": "Reading materials",
  "isActive": true,
  "subcategory": [
    {
      "_id": 5,
      "subcategory_name": "Fiction",
      "product_name": [
        "To Kill a Mockingbird",
        "The Great Gatsby"
      ],
      "CountProduct": 2
    }
  ]
}
{
  "_id": 3,
  "category_name": "Books",
  "category_desc": "Reading materials",
  "isActive": true,
  "subcategory": [
    {
      "_id": 5,
      "subcategory_name": "Fiction",
      "product_name": [
        "To Kill a Mockingbird",
        "The Great Gatsby"
      ],
      "CountProduct": 2
    }
  ]
}
{
  "_id": 4,
  "category_name": "Furniture",
  "category_desc": "Home and office furniture",
  "isActive": true,
  "subcategory": [
    {
      "_id": 7,
      "subcategory_name": "Living Room",
      "product_name": [
        "Leather Sofa",
        "Coffee Table"
      ],
      "CountProduct": 2
    }
  ]
}




--------------------------------------------------------------------------------------------------
23. Retrieve Payments with Order and Product Details.
[
  {
    $unwind: {
      path: "$products"
    }
  },
  {
    $lookup: {
      from: "products",
      localField: "products.product_id",
      foreignField: "_id",
      as: "product"
    }
  },
  {
    $unwind: {
      path: "$product"
    }
  },
  {
    $group: {
      _id: "$_id",
      "payment_id": {
        $first : "$payment_id"
      },
      "product" : {
        $push : "$product"
      }
    }
  },
  {
    $lookup: {
      from: "payments",
      localField: "payment_id",
      foreignField: "_id",
      as: "payment"
    }
  },
  {
    $unwind: {
      path: "$payment"
    }
  },
  {
    $project: {
      "gatway" : "$payment.gateway",
      "status" : "$payment.status",
      "payment_id": "$payment_id",
      "product" : 1
    }
  }
  
]


{
  "_id": 10,
  "product": [
    {
      "_id": 1,
      "category_id": 1,
      "subcategory_id": 1,
      "variant_id": 1,
      "name": "iPhone 12",
      "description": "Flagship smartphone",
      "isActive": true
    },
    {
      "_id": 10,
      "category_id": 4,
      "subcategory_id": 7,
      "variant_id": 10,
      "name": "Coffee Table",
      "description": "Functional and stylish",
      "isActive": true
    }
  ],
  "gatway": "PayPal",
  "status": "Pending",
  "payment_id": 110
}
% as sem other data....
--------------------------------------------------------------------------------------------------